var resolutions=[{name:"default",value:"default"},{name:"480p",value:"480p"},{name:"720p",value:"720p"},{name:"1080p",value:"1080p"}];function Toastify(e){M.toast({html:e.text,classes:e.classes})}var Toast={info:e=>{Toastify({text:e,classes:"info-toast"})},notice:e=>{Toastify({text:e,classes:"notice-toast"})},error:e=>{Toastify({text:e,classes:"error-toast"})}};function validator(e,o){var i=Object.keys(e);for(let a of i)if(-1!=o.indexOf(a)&&!e[a])return Toast.error("Please Enter "+a),!1;return!0}function serializeformData(){var e=$("#form").serializeArray(),o={};for(var i of e){var a=i.name,n=i.value;o[a]=n}return o}function addView(e,o){$("#"+e)[0]||($("<div/>",{id:"remote_video_panel_"+e,class:"video-view"}).appendTo("#video"),$("<div/>",{id:"remote_video_"+e,class:"video-placeholder"}).appendTo("#remote_video_panel_"+e),$("<div/>",{id:"remote_video_info_"+e,class:"video-profile "+(o?"":"hide")}).appendTo("#remote_video_panel_"+e),$("<div/>",{id:"video_autoplay_"+e,class:"autoplay-fallback hide"}).appendTo("#remote_video_panel_"+e))}function removeView(e){$("#remote_video_panel_"+e)[0]&&$("#remote_video_panel_"+e).remove()}function getDevices(e){AgoraRTC.getDevices((function(o){o.filter((function(e){return-1!==["audioinput","videoinput"].indexOf(e.kind)})).map((function(e){return{name:e.label,value:e.deviceId,kind:e.kind}}));for(var i=[],a=[],n=0;n<o.length;n++){var t=o[n];if("videoinput"==t.kind){var r=t.label,l=t.deviceId;r||(r="camera-"+i.length),i.push({name:r,value:l,kind:t.kind})}if("audioinput"==t.kind){r=t.label,l=t.deviceId;r||(r="microphone-"+a.length),a.push({name:r,value:l,kind:t.kind})}}e({videos:i,audios:a})}))}var rtc={client:null,joined:!1,published:!1,localStream:null,remoteStreams:[],params:{}};function handleEvents(e){e.client.on("error",e=>{}),e.client.on("peer-leave",(function(o){var i=o.uid;i!=e.params.uid&&removeView(i),Toast.notice("peer leave")})),e.client.on("stream-published",(function(e){Toast.notice("stream published success")})),e.client.on("stream-added",(function(o){var i=o.stream,a=i.getId();Toast.info("stream-added uid: "+a),a!==e.params.uid&&e.client.subscribe(i,(function(e){}))})),e.client.on("stream-subscribed",(function(o){var i=o.stream,a=i.getId();e.remoteStreams.push(i),addView(a),i.play("remote_video_"+a),Toast.info("stream-subscribed remote-uid: "+a)})),e.client.on("stream-removed",(function(o){var i=o.stream,a=i.getId();Toast.info("stream-removed uid: "+a),i.stop("remote_video_"+a),e.remoteStreams=e.remoteStreams.filter((function(e){return e.getId()!==a})),removeView(a)})),e.client.on("onTokenPrivilegeWillExpire",(function(){Toast.info("onTokenPrivilegeWillExpire")})),e.client.on("onTokenPrivilegeDidExpire",(function(){Toast.info("onTokenPrivilegeDidExpire")}))}function join(e,o){e.joined?Toast.error("Your already joined"):(e.client=AgoraRTC.createClient({mode:o.mode,codec:o.codec}),e.params=o,handleEvents(e),e.client.init(o.appID,(function(){e.client.join(o.token?o.token:null,o.channel,o.uid?+o.uid:null,(function(i){Toast.notice("join channel: "+o.channel+" success, uid: "+i),e.joined=!0,e.params.uid=i,e.localStream=AgoraRTC.createStream({streamID:e.params.uid,audio:!0,video:!0,screen:!1,microphoneId:o.microphoneId,cameraId:o.cameraId}),e.localStream.init((function(){e.localStream.play("local_stream"),publish(e)}),(function(e){Toast.error("stream init failed, please open console see more detail")}))}),(function(e){Toast.error("client join failed, please open console see more detail")}))}),e=>{Toast.error("client init failed, please open console see more detail")}))}function publish(e){if(e.client)if(e.published)Toast.error("Your already published");else{var o=e.published;e.client.publish(e.localStream,(function(i){e.published=o,Toast.error("publish failed")})),Toast.info("publish"),e.published=!0}else Toast.error("Please Join Room First")}function unpublish(e){if(e.client)if(e.published){var o=e.published;e.client.unpublish(e.localStream,(function(i){e.published=o,Toast.error("unpublish failed")})),Toast.info("unpublish"),e.published=!1}else Toast.error("Your didn't publish");else Toast.error("Please Join Room First")}function leave(e){e.client?e.joined?e.client.leave((function(){for(e.localStream.stop(),e.localStream.close();e.remoteStreams.length>0;){var o=e.remoteStreams.shift(),i=o.getId();o.stop(),removeView(i)}e.localStream=null,e.remoteStreams=[],e.client=null,e.published=!1,e.joined=!1,Toast.notice("leave success")}),(function(e){Toast.error("leave success")})):Toast.error("You are not in channel"):Toast.error("Please Join First!")}$((function(){getDevices((function(e){e.audios.forEach((function(e){$("<option/>",{value:e.value,text:e.name}).appendTo("#microphoneId")})),e.videos.forEach((function(e){$("<option/>",{value:e.value,text:e.name}).appendTo("#cameraId")})),resolutions.forEach((function(e){$("<option/>",{value:e.value,text:e.name}).appendTo("#cameraResolution")})),M.AutoInit()}));var e=["appID","channel"];$("#join").on("click",(function(o){o.preventDefault();var i=serializeformData();validator(i,e)&&join(rtc,i)})),$("#publish").on("click",(function(o){o.preventDefault(),validator(serializeformData(),e)&&publish(rtc)})),$("#unpublish").on("click",(function(o){o.preventDefault(),validator(serializeformData(),e)&&unpublish(rtc)})),$("#leave").on("click",(function(o){o.preventDefault(),validator(serializeformData(),e)&&leave(rtc)}))}));